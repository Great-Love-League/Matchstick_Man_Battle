# 按键映射更新说明 (Keymap Update)

## 更新内容

将武器切换按键从字母键改为**数字键**（字母区上方的一排数字键1-4）

## 修改前后对比

| 功能 | 旧按键 | 新按键 | 备注 |
|------|--------|--------|------|
| 装备手枪 | `I` | `1` | 字母区上方的数字1 |
| 装备霰弹枪 | `O` | `2` | 字母区上方的数字2 |
| 装备狙击枪 | `P` | `3` | 字母区上方的数字3 |
| 装备激光枪 | `L` | `4` | 字母区上方的数字4 |
| 射击 | `Z` | `Z` | 保持不变 |
| 向左移动 | `A` | `A` | 保持不变 |
| 向右移动 | `D` | `D` | 保持不变 |
| 跳跃 | `W` | `W` | 保持不变 |

## 完整按键说明

### 武器控制
- **数字1键**：装备手枪 (Pistol)
  - 伤害：10
  - 射速：快速
  - 后坐力：轻微
  
- **数字2键**：装备霰弹枪 (Shotgun)
  - 伤害：6×5发
  - 射速：慢速
  - 后坐力：强烈
  
- **数字3键**：装备狙击枪 (Sniper)
  - 伤害：30
  - 射速：慢速
  - 后坐力：中等
  - 特性：穿透2个目标
  
- **数字4键**：装备激光枪 (Laser Rifle)
  - 伤害：15
  - 射速：极快
  - 后坐力：中等
  - 特性：穿透5个目标

- **Z键**：射击当前装备的武器

### 移动控制
- **A键**：向左移动
- **D键**：向右移动
- **W键**：跳跃

### 测试功能
- **J键**：使角色进入昏迷状态（测试用）
- **K键**：在角色前方生成生命包（测试用）

## 技术实现

### 代码修改位置
`src/server/game.mbt` 第54-103行

### 修改内容

```moonbit
// 修改前
if(p.keyIsDown(KeyI)){  // 使用字母 I
  self.create_pistol(0)
}

// 修改后
if(p.keyIsDown(Digit1)){  // 使用数字 1
  self.create_pistol(0)
}
```

### KeyCode 枚举
- `Digit1` - 数字键 1（字母区上方）
- `Digit2` - 数字键 2（字母区上方）
- `Digit3` - 数字键 3（字母区上方）
- `Digit4` - 数字键 4（字母区上方）

**注意**：小键盘的数字键是不同的 KeyCode（Numpad1-9），这里使用的是主键盘区（字母上方）的数字键。

## 优势说明

### 1. 更符合游戏习惯
- 大多数游戏使用数字键切换武器（CS、CF、PUBG等）
- 玩家手指自然放在 WASD 上，数字键 1-4 易于触及

### 2. 按键布局合理
```
[1] [2] [3] [4] [5] [6] [7] [8] [9] [0]
  [Q] [W] [E] [R] [T] [Y] [U] [I] [O] [P]
   [A] [S] [D] [F] [G] [H] [J] [K] [L]
    [Z] [X] [C] [V] [B] [N] [M]
```

- 数字键 1-4：武器切换（左手食指/中指/无名指可快速切换）
- WASD：移动控制（左手主要操作区域）
- Z：射击（左手小指，易于连续按压）

### 3. 避免按键冲突
- 旧方案 I/O/P/L 位于键盘右侧，需要右手操作
- 新方案 1-4 位于键盘上方，左手可完成所有操作
- 右手可用于鼠标视角控制（未来扩展）

## 测试验证

### 基本测试
1. 启动游戏：`npx serve .` 访问 `http://localhost:3000`
2. 按数字键 1-4 测试武器切换
3. 观察控制台输出："装备手枪!" / "装备霰弹枪!" 等
4. 按 Z 键测试射击功能

### 手感测试
1. 左手放在 WASD 位置
2. 用食指快速按 1、2、3、4 切换武器
3. 确认切换流畅，不影响移动操作
4. 测试边移动边切换武器的操作

### 预期结果
- ✅ 数字键 1-4 可正常切换武器
- ✅ 控制台正确输出武器名称
- ✅ Z 键可正常射击当前武器
- ✅ 左手可完成所有战斗操作
- ✅ 操作流畅，符合游戏手感

## 相关文档更新

需要更新以下文档中的按键说明：
- [ ] `WEAPON_DEMO_GUIDE.md` - 武器演示指南
- [ ] `BULLET_PHYSICS_OPTIMIZATION.md` - 子弹物理优化
- [ ] `RECOIL_SYSTEM.md` - 后坐力系统
- [ ] `POSITION_ADJUSTMENT.md` - 位置调整说明
- [ ] `MUZZLE_LIMITER.md` - 枪口限位系统

所有提到 I/O/P/L 键的地方都应更新为 1/2/3/4 键。

## 版本历史

- **v1.0 (2025-10-19)**：从 I/O/P/L 改为 1/2/3/4（Digit1/2/3/4）

---

**状态**：✅ 已实现并通过编译测试  
**编译结果**：`Finished. moon: ran 2 tasks, now up to date`  
**影响范围**：武器切换控制（4个按键）  
**测试状态**：等待游戏内测试验证
