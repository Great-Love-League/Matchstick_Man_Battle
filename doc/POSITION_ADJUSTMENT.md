# 位置调整说明 📍

## ✅ 已完成的调整

### 人物初始位置
- **旧位置**: `(0.0, 10.0)` - 悬空在半空中
- **新位置**: `(-3.0, 12.0)` - 站在平台2上

### 敌人初始位置
- **旧位置**: `(5.0, 10.0)` - 可能掉落或在墙外
- **新位置**: `(-1.0, 12.0)` - 站在平台2上，与玩家同一平台

---

## 🗺️ 地图平台信息

根据 `world_resource.mbt` 中的 level1 数据：

### 平台1（下方平台）
- **位置**: `(-15.9, 3.65)`
- **大小**: 10米 × 1米
- **顶部Y坐标**: 3.65 + 0.5 = **4.15**
- **X范围**: -20.9 到 -10.9

### 平台2（中间平台）⭐ 当前使用
- **位置**: `(-5.77, 8.9)`
- **大小**: 10米 × 1米
- **顶部Y坐标**: 8.9 + 0.5 = **9.4**
- **X范围**: -10.77 到 -0.77
- **玩家位置**: (-3.0, 12.0) - 平台中心偏左
- **敌人位置**: (-1.0, 12.0) - 平台右侧

### 墙壁（右侧）
- **位置**: `(7.85, 19.275)`
- **大小**: 1米 × 19.45米（垂直墙）

### 斜坡
- **位置**: `(16.0875, 10.7375)`
- **类型**: 多边形（倾斜平台）

---

## 🎮 为什么选择这些位置？

### 玩家位置: (-3.0, 12.0)
1. **X坐标 -3.0**:
   - 在平台2的中心偏左
   - 平台范围: -10.77 到 -0.77
   - 有足够的移动空间（左右各约3米）

2. **Y坐标 12.0**:
   - 平台顶部: 9.4
   - 人物高度约3.5米
   - 12.0 - 3.5/2 ≈ 10.25，稳定站立
   - 留有余地防止掉落

### 敌人位置: (-1.0, 12.0)
1. **X坐标 -1.0**:
   - 在平台2的右侧
   - 与玩家距离: -3.0 - (-1.0) = 2米
   - 足够近以便交战
   - 足够远以便观察

2. **Y坐标 12.0**:
   - 与玩家同高度
   - 公平的战斗起点

---

## 📐 坐标系统

Box2D 坐标系统：
```
Y轴
↑
|     玩家(-3, 12)  敌人(-1, 12)
|          ●            ●
|     ==================== 平台2 (y=9.4)
|
|
|     ==================== 平台1 (y=4.15)
|
└────────────────────────────→ X轴
```

---

## 🔧 修改的文件

### `src/server/main.mbt`

#### 修改1: 玩家位置
```moonbit
// 旧代码
game.create_particle((0.0, 10.0)) |> ignore

// 新代码（带注释）
// 平台2的位置: (-5.77, 8.9)，大小: 10x1
// 平台顶部: y = 8.9 + 0.5 = 9.4
// 人物高度约3.5米，所以放在 y = 9.4 + 2.0 = 11.4
// x坐标在平台范围内: -5.77 ± 5 = (-10.77, -0.77)
// 选择平台中心偏左: x = -3.0
game.create_particle((-3.0, 12.0)) |> ignore
```

#### 修改2: 敌人位置
```moonbit
// 旧代码
create_box_enemy(game, (5.0, 10.0)) |> ignore

// 新代码（带注释）
// 创建敌人，放在平台2的右侧
// 平台2范围: x ∈ (-10.77, -0.77)
// 将敌人放在右侧: x = -1.0
create_box_enemy(game, (-1.0, 12.0)) |> ignore
```

---

## ✨ 效果

### 启动游戏后
1. ✅ 玩家站在平台2的中心偏左位置
2. ✅ 敌人站在平台2的右侧，与玩家同一平台
3. ✅ 两者之间距离约2米，适合测试战斗
4. ✅ 不会掉落或悬空
5. ✅ 按 A/D 可以在平台上移动
6. ✅ 按 W 可以跳跃
7. ✅ 按 I/O/P/L 装备武器
8. ✅ 按 S 射击

### 视觉布局
```
        玩家         敌人
         ●  →  →  →  ●
    ========================  平台2
         ← 2米距离 →
```

---

## 🎯 测试建议

### 测试1: 基础站立
```
预期: 玩家和敌人稳定站立在平台上
操作: 启动游戏，观察1秒
结果: 无掉落，无抖动
```

### 测试2: 左右移动
```
预期: 可以在平台上自由移动
操作: 按 A 向左，按 D 向右
结果: 平滑移动，不掉出平台
```

### 测试3: 跳跃
```
预期: 可以跳跃并落回平台
操作: 按 W 跳跃
结果: 跳起后落回平台上
```

### 测试4: 射击测试
```
预期: 子弹可以击中敌人
操作: 
  1. 按 I 装备手枪
  2. 面向敌人
  3. 按 S 射击
结果: 子弹飞向敌人并造成伤害
```

### 测试5: 战斗测试
```
预期: 可以在平台上进行战斗
操作:
  1. 按 D 靠近敌人
  2. 按 I 装备手枪
  3. 连续按 S 射击
  4. 按 A 后退
  5. 按 W 跳跃躲避
结果: 流畅的战斗体验
```

---

## 📝 未来可调整的选项

### 如果需要更远的距离
```moonbit
game.create_particle((-8.0, 12.0)) |> ignore  // 玩家在平台最左侧
create_box_enemy(game, (-1.0, 12.0)) |> ignore  // 敌人在右侧
// 距离: 7米
```

### 如果需要更近的距离
```moonbit
game.create_particle((-3.0, 12.0)) |> ignore
create_box_enemy(game, (-2.0, 12.0)) |> ignore
// 距离: 1米（近战）
```

### 如果需要使用下方平台
```moonbit
// 平台1范围: (-20.9, -10.9) 到 (-10.9, 4.15)
game.create_particle((-16.0, 6.5)) |> ignore
create_box_enemy(game, (-14.0, 6.5)) |> ignore
```

### 如果需要多个玩家
```moonbit
game.create_particle((-5.0, 12.0)) |> ignore  // 玩家1
game.create_particle((-1.0, 12.0)) |> ignore  // 玩家2
```

---

## 🎉 总结

✅ **玩家初始位置**: 从 (0.0, 10.0) 调整为 (-3.0, 12.0)  
✅ **敌人初始位置**: 从 (5.0, 10.0) 调整为 (-1.0, 12.0)  
✅ **平台**: 两者都在平台2上，稳定站立  
✅ **距离**: 2米，适合测试战斗  
✅ **编译**: 成功，无错误  

现在启动游戏，玩家和敌人都会稳定地站在平台上！🎮
