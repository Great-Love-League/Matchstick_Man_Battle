# 武器系统演示指南 🔫

完整的武器系统已集成到游戏中！本指南介绍如何使用4种不同的武器。

---

## 🎮 按键控制

### 武器装备（按键切换）

| 按键 | 武器类型 | 特性 |
|------|---------|------|
| **I** | 手枪 Pistol | 低伤害(10)，快射速(15帧) |
| **O** | 霰弹枪 Shotgun | 散射(5发)，慢射速(40帧) |
| **P** | 狙击枪 Sniper | 高伤害(30)，穿透(2)，超慢射速(60帧) |
| **L** | 激光枪 LaserRifle | 中伤害(15)，高穿透(5)，超快射速(5帧) |

### 射击控制

| 按键 | 功能 | 说明 |
|------|------|------|
| **S** | 使用武器射击 | 根据当前装备的武器类型发射子弹 |
| **Z** | 徒手发射子弹 | 不需要武器，直接发射基础子弹 |

### 移动控制（原有）

| 按键 | 功能 |
|------|------|
| **A** | 向左移动 |
| **D** | 向右移动 |
| **W** | 跳跃 |
| **K** | 生成生命包（测试用） |
| **J** | 角色昏倒（测试用） |

---

## 🔫 武器详细说明

### 1. 手枪 (Pistol) - 按 I 装备

**特性**：
- ✅ 伤害：10
- ✅ 射速：每15帧（约0.25秒）
- ✅ 子弹速度：20
- ✅ 穿透：无
- ✅ 目标：仅玩家

**适用场景**：
- 快速射击
- 中距离战斗
- 平衡的伤害和射速

**使用方法**：
```
1. 按 I 键装备手枪
2. 按 S 键射击
3. 可以快速连射
```

---

### 2. 霰弹枪 (Shotgun) - 按 O 装备

**特性**：
- ✅ 伤害：6 × 5发 = 30（近距离全中）
- ✅ 射速：每40帧（约0.67秒）
- ✅ 子弹速度：18
- ✅ 散射角度：30度扇形
- ✅ 穿透：无
- ✅ 目标：仅玩家

**适用场景**：
- 近距离战斗
- 对付多个目标
- 高爆发伤害

**使用方法**：
```
1. 按 O 键装备霰弹枪
2. 接近敌人
3. 按 S 键射击（同时发射5发子弹）
4. 注意射速较慢，需要计算好时机
```

**散射模式**：
```
        •  (子弹1: +15度)
      •    (子弹2: +7.5度)
    •      (子弹3: 0度 - 中心)
      •    (子弹4: -7.5度)
        •  (子弹5: -15度)
```

---

### 3. 狙击枪 (Sniper) - 按 P 装备

**特性**：
- ✅ 伤害：30（高伤害）
- ✅ 射速：每60帧（1秒）
- ✅ 子弹速度：30（快速）
- ✅ 穿透：2个目标
- ✅ 目标：仅玩家

**适用场景**：
- 远距离狙击
- 穿透多个敌人
- 一击致命

**使用方法**：
```
1. 按 P 键装备狙击枪
2. 瞄准敌人排成一线
3. 按 S 键射击
4. 子弹可穿透2个目标
5. 注意射速很慢，需要精准射击
```

**穿透机制**：
```
你 ➜ [子弹] ➜ 敌人1(受伤30) ➜ [子弹继续] ➜ 敌人2(受伤30) ➜ [子弹消失]
```

---

### 4. 激光枪 (LaserRifle) - 按 L 装备

**特性**：
- ✅ 伤害：15
- ✅ 射速：每5帧（约0.08秒，超快！）
- ✅ 子弹速度：35（超快）
- ✅ 穿透：5个目标
- ✅ 目标：仅玩家

**适用场景**：
- 压制性火力
- 对付大群敌人
- 高穿透需求

**使用方法**：
```
1. 按 L 键装备激光枪
2. 按住 S 键持续射击
3. 子弹可穿透5个目标
4. 射速极快，形成火力网
```

**穿透示例**：
```
你 ➜ 激光 ➜ 敌1 ➜ 敌2 ➜ 敌3 ➜ 敌4 ➜ 敌5 ➜ 消失
     (所有敌人都受到15点伤害)
```

---

## 📊 武器对比表

| 武器 | 伤害 | 射速 | 子弹数 | 穿透 | DPS (伤害/秒) | 适用距离 |
|------|------|------|--------|------|--------------|---------|
| 手枪 | 10 | 快(15帧) | 1 | 0 | 40 | 中距离 |
| 霰弹枪 | 6×5 | 慢(40帧) | 5 | 0 | 45 | 近距离 |
| 狙击枪 | 30 | 很慢(60帧) | 1 | 2 | 30 | 远距离 |
| 激光枪 | 15 | 超快(5帧) | 1 | 5 | 180 | 中远距离 |

**DPS计算**：伤害 × (60帧/秒 ÷ 射速间隔)

---

## 🎯 使用示例

### 示例1：基础战斗

```
场景：与另一个玩家对战

1. 按 I 装备手枪
2. 按 D 向右移动靠近敌人
3. 按 S 快速射击
4. 敌人血量：100 → 90 → 80 → 70...
5. 10发击倒敌人
```

---

### 示例2：近距离爆发

```
场景：敌人靠近时

1. 按 O 装备霰弹枪
2. 等待敌人接近（2-3米内）
3. 按 S 射击
4. 5发子弹同时命中，造成30点伤害
5. 4次射击击倒敌人（120伤害）
```

---

### 示例3：狙击穿透

```
场景：多个敌人排成一线

1. 按 P 装备狙击枪
2. 等待敌人站成一排
3. 按 S 射击
4. 子弹穿透第一个敌人（30伤害）
5. 继续穿透第二个敌人（30伤害）
6. 两个敌人同时受伤
```

---

### 示例4：激光压制

```
场景：对付多个敌人

1. 按 L 装备激光枪
2. 按住 S 键持续射击
3. 每0.08秒发射一发
4. 形成激光雨，压制敌人
5. 高穿透可击中躲在后方的敌人
```

---

## 🔧 技术实现

### 武器结构

```moonbit
struct Gun {
  id : Int
  owner_id : Int
  body : @box2d.B2Body
  
  // 子弹配置
  bullet_damage : Double      // 伤害
  bullet_speed : Double       // 速度
  bullet_penetration : Int    // 穿透次数
  bullet_targets : Array[TargetType]  // 目标类型
  
  // 射击控制
  fire_rate : Int             // 射速（帧间隔）
  mut last_fire_frame : Int   // 上次射击帧
  
  gun_type : GunType          // 武器类型
}
```

### 射击逻辑

```moonbit
pub impl WeaponControl for Gun with attack(self, game) {
  // 检查冷却
  if game.frame_count - self.last_fire_frame < self.fire_rate {
    return  // 还在冷却中
  }
  
  // 根据武器类型选择射击方式
  match self.gun_type {
    Pistol => game.shoot_bullet(...)
    Shotgun => game.shoot_shotgun(...)
    Sniper => game.shoot_penetrating_bullet(..., 2)
    LaserRifle => game.shoot_penetrating_bullet(..., 5)
  }
  
  // 更新冷却
  self.last_fire_frame = game.frame_count
}
```

---

## 🎮 完整操作流程

### 启动游戏

```powershell
# 1. 编译
moon build --target js --warn-list -A

# 2. 启动服务器
npx serve .

# 3. 打开浏览器
http://localhost:3000
```

### 游戏内操作

```
步骤1：装备武器
按 I / O / P / L 选择武器
（控制台会显示 "装备手枪!" 等提示）

步骤2：移动到位
按 A / D 左右移动
按 W 跳跃

步骤3：射击
按 S 键使用武器射击
（控制台会显示 "手枪射击! 持有者: #0" 等信息）

步骤4：观察效果
- 看到子弹发射（Box2D物理体）
- 看到命中日志（控制台）
- 看到伤害计算（血量减少）

步骤5：切换武器
随时按 I / O / P / L 切换不同武器
（旧武器会被销毁，新武器会创建）
```

---

## 🐛 调试信息

### 控制台输出示例

```
装备手枪!
手枪射击! 持有者: #0
玩家 0 发射了普通子弹
创建子弹 #1 (伤害: 10.0)
子弹 #1 击中玩家 1, 伤害 10.0 (剩余血量: 90.0)
子弹 #1 超出最大距离 50.0, 已失效

装备狙击枪!
狙击枪射击! 持有者: #0
玩家 0 发射了穿透子弹 (穿透次数: 2)
创建子弹 #2 (伤害: 30.0)
子弹 #2 击中玩家 1, 伤害 30.0 (剩余血量: 60.0)
子弹 #2 穿透! 剩余穿透次数: 1
子弹 #2 击中玩家 2, 伤害 30.0 (剩余血量: 70.0)
子弹 #2 穿透次数耗尽, 已失效
```

---

## ✨ 特色功能

### 1. 智能冷却系统
- 每种武器独立的射速控制
- 防止过快射击
- 基于帧数的精确计时

### 2. 武器切换
- 即时销毁旧武器
- 自动创建新武器
- 绑定到角色右前臂

### 3. 子弹集成
- 每种武器调用不同的子弹方法
- 自动计算方向（基于角色朝向）
- 完整的碰撞检测

### 4. 物理渲染
- 武器是真实的Box2D物体
- 随角色手臂移动
- 参与物理模拟

---

## 📋 开发者备注

### 添加新武器

如果要添加新武器类型，按以下步骤：

```moonbit
// 1. 在 weapon.mbt 中添加新类型
enum GunType {
  Pistol
  Shotgun
  Sniper
  LaserRifle
  Minigun  // 新武器
}

// 2. 创建快捷方法
fn Game::create_minigun(self : Self, owner_id : Int) -> Unit {
  // 配置参数
  let gun:Gun = Gun::{
    bullet_damage: 5.0,
    bullet_speed: 25.0,
    fire_rate: 3,  // 极快射速
    gun_type: Minigun
  }
  // ...
}

// 3. 在 Gun::attack 中添加匹配分支
match self.gun_type {
  Minigun => {
    game.shoot_bullet(self.owner_id, direction)
    println("机枪射击!")
  }
}

// 4. 在 game.mbt 中添加按键
if(p.keyIsDown(KeyU)){
  self.create_minigun(0)
  println("装备机枪!")
}
```

### 调整武器参数

修改 `weapon.mbt` 中的配置：

```moonbit
// 示例：让手枪更强
fn Game::create_pistol(...) {
  let gun:Gun = Gun::{
    bullet_damage: 20.0,  // 从10改为20
    fire_rate: 10,        // 从15改为10（更快）
    // ...
  }
}
```

---

## 🎉 总结

现在你有：
- ✅ 4种完整可用的武器
- ✅ 武器装备/切换系统
- ✅ 射击控制系统
- ✅ 子弹集成
- ✅ 冷却机制
- ✅ 物理渲染
- ✅ 完整的调试输出

**开始游戏，体验不同的武器吧！** 🎮🔫

---

**相关文档**：
- `BULLET_USAGE_GUIDE.md` - 子弹系统详细文档
- `ITEM_SYSTEM_README.md` - 物品系统文档
- `BULLET_ITEM_SUMMARY.md` - 系统总览
